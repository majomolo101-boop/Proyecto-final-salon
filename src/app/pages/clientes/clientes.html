<div class="cliente-container">
  <h1 class="title">Clientes</h1>

  <span class="toast-message" *ngIf="message">{{ message }}</span>

  <div class="top-controls">
    <button class="btn-create" (click)="handleCreateNew()">Crear +</button>

    <div class="search-wrapper">
      <input
        type="text"
        class="search-input"
        placeholder="Buscar"
        [(ngModel)]="searchTerm"
        (input)="handleSearch()"
      />
      <i class="fa fa-search search-icon"></i>
    </div>
  </div>

  <div class="search-result-message" *ngIf="searchTerm !== ''">
    <span *ngIf="filteredClients && filteredClients.length > 0">
      {{ filteredClients.length }} resultado(s) encontrado(s)
    </span>
    <span *ngIf="filteredClients && !filteredClients.length">
      No se encontraron resultados para "{{ searchTerm }}"
    </span>
  </div>

  <!-- FORMULARIO CREAR/EDITAR CLIENTE -->
  <div class="form-modal" *ngIf="showForm">
    <div class="form-container">
      <div class="form-header">
        <h2>{{ editingId ? 'Editar Cliente' : 'Nuevo Cliente' }}</h2>
      </div>

      <form (ngSubmit)="handleSave()" class="form-content">
        <div class="form-grid">
          <div class="form-group">
            <label>Nombre</label>
            <input type="text" [(ngModel)]="formData.nombre" name="nombre" required placeholder="Ingresa el nombre" />
          </div>

          <div class="form-group">
            <label>Apellido</label>
            <input type="text" [(ngModel)]="formData.apellido" name="apellido" required placeholder="Ingresa el apellido" />
          </div>

          <div class="form-group">
            <label>Tipo de evento</label>
            <input type="text" [(ngModel)]="formData.tipo_evento" name="tipo_evento" required placeholder="Ingesa evento" />
          </div>

          <div class="form-group">
            <label>Fecha del evento</label>
            <input type="date" [(ngModel)]="formData.fechaEvento" name="fechaEvento" required placeholder="Selecciona la fecha" />
          </div>

          <div class="form-group">
            <label>Teléfono</label>
            <input type="tel" [(ngModel)]="formData.telefono" name="telefono" required placeholder="Ingresa teléfono" />
          </div>

          <div class="form-group">
            <label>Email</label>
            <input type="email" [(ngModel)]="formData.email" name="email" required placeholder="Ingresa correo" />
          </div>

          <div class="form-group">
            <label>Número de personas</label>
            <input type="number" [(ngModel)]="formData.numeroPersonas" name="numeroPersonas" required placeholder="Cantidad de invitados" />
          </div>

          <div class="form-group">
            <label>Hora de entrada</label>
            <input type="time" [(ngModel)]="formData.fechaEntrada" name="fechaEntrada" required placeholder="HH:MM" />
          </div>

          <div class="form-group">
            <label>Hora de salida</label>
            <input type="time" [(ngModel)]="formData.fechaSalida" name="fechaSalida" required placeholder="HH:MM" />
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="handleCancel()">Cancelar</button>
          <button type="submit" class="btn-save">
            {{ editingId ? 'Actualizar' : 'Guardar' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ESTADO VACÍO -->
  <div class="empty-state" *ngIf="!(clients && clients.length > 0) && !showForm">
    <p class="empty-title">No hay clientes registrados</p>
    <p class="empty-subtitle">Crea uno nuevo para comenzar</p>
  </div>

  <!-- LISTA DE CLIENTES -->
  <div class="clients-list" *ngIf="filteredClients && filteredClients.length > 0">
    <div class="client-card" *ngFor="let client of filteredClients">
      <div class="client-summary" (click)="handleToggleExpand(client.id)">
        <h3>{{ client.nombre }} {{ client.apellido }}</h3>
        <p><strong>Tipo de evento:</strong> {{ client.tipo_evento }}</p>
      </div>

      <div class="client-details" *ngIf="expandedId === client.id">
        <div class="detail"><span>Fecha:</span> {{ client.fechaEvento }}</div>
        <div class="detail"><span>Hora entrada:</span> {{ convertToAMPM(client.fechaEntrada) }}</div>
        <div class="detail"><span>Hora salida:</span> {{ convertToAMPM(client.fechaSalida) }}</div>
        <div class="detail"><span>Teléfono:</span> {{ client.telefono }}</div>
        <div class="detail"><span>Email:</span> {{ client.email }}</div>
        <div class="detail"><span>Personas:</span> {{ client.numeroPersonas }}</div>

        <div class="actions-icons">
          <button class="icon-btn edit" (click)="handleEdit(client); $event.stopPropagation()">
            <i class="fa-solid fa-pen-to-square"></i>
          </button>

          <button class="icon-btn delete" (click)="handleDelete(client.id); $event.stopPropagation()">
            <i class="fa-solid fa-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
